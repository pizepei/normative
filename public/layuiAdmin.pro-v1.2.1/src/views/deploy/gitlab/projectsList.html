<title>项目列表</title>
<div class="layui-card layadmin-header">
    <div class="layui-breadcrumb" lay-filter="breadcrumb">
        <a lay-href="">主页</a>
        <a><cite>项目部署</cite></a>
        <a><cite>GitLab</cite></a>
        <a><cite>项目列表</cite></a>
    </div>
</div>

<div class="layui-fluid">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12">
            <div class="layui-card">
                <div class="layui-card-header">群组（groups）</div>
                <div class="layui-card-body">

                    <form class="layui-form" action="" lay-filter="component-form-group">

                        <div class="layui-form-item">
                        <div class="layui-inline">
                            <label class="layui-form-label">群组</label>
                            <div class="layui-input-inline">
                                    <script type="text/html" template lay-url="/gitlab/groups-list.json" lay-done="layui.data.done(d);">
                                        <select name="modules" lay-verify="required" lay-search=""  lay-filter="groups-list">
                                            <option value="">直接选择或搜索选择</option>
                                            {{#  layui.each(d.data.list, function(index, item){ }}
                                            <li>
                                                <option value="{{item.id}}">{{item.name}}</option>
                                            </li>
                                            {{#  }); }}
                                        </select>

                                    </script>

                            </div>
                        </div>
                    </div>
                    </form>


                </div>
            </div>
        </div>
        <div class="layui-col-md12">
            <div class="layui-card">
                <div class="layui-card-header">项目列表</div>
                <div class="layui-card-body">

                    <table class="layui-hide" id="test-table-resetPage"></table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    //群组列表
    layui.data.done = function(d){
        layui.use(['form'], function(){
            var form = layui.form;
            form.render(null, 'component-form-group');//渲染该模板下的动态表单
        });
    };


    layui.use(['admin', 'table'], function(){
        var admin = layui.admin
            ,form = layui.form
            ,table = layui.table;
        //选择群组
        form.on('select(groups-list)', function(data){
            console.log(data.elem); //得到select原始DOM对象
            getGroups(data.value);
            console.log(data.value); //得到被选中的值
            console.log(data.othis); //得到美化后的DOM对象
        });

        function getGroups(id='')
        {
            table.render({
                elem: '#test-table-resetPage'
                ,url: '/gitlab/groups/'+id+'/projects.json'
                ,type:'get'
                ,response: {
                    statusCode: 200 //规定成功的状态码，默认：0
                }
                ,parseData: function(res){ //res 即为原始返回的数据
                    return {
                        "code": res.code, //解析接口状态
                        "msg": res.msg, //解析提示文本
                        "count": res.data.total, //解析数据长度
                        "data": res.data.list //解析数据列表
                    };
                }
                ,cellMinWidth: 90 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
                ,cols: [[
                    ,{field:'id', title: 'ID'}
                    ,{field:'name', title: '项目标识'}
                    ,{field:'description', title: '项目描述'}
                    ,{field:'avatar_url',  title: '项目图标'
                        ,templet: function(d){
                            return '<img style="height: 100%" src='+ d.avatar_url +'">'
                        }
                    }
                    ,{field:'namespace.description',  title: '群组介绍'
                        ,templet: function(d){
                        return d.namespace.description;
                    }}
                    ,{field:'web_url',  title: '首页'}
                ]]
            });
        }



    });
</script>