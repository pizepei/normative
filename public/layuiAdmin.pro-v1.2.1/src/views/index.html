
<div class="layui-fluid">
  <div class="layui-row layui-col-space15">

    <script type="text/html" template lay-url="/home/console/person/shortcut-list.json">

      {{#  layui.each(d.data, function(index, item){ }}
          <div class="layui-col-md4">
            <div class="layui-card">
              <div class="layui-card-header" lay-tips="{{item.explain }}">{{ item.name }}</div>
              <div class="layui-card-body">
                <div class="layuiadmin-card-link" >
                  {{#  layui.each(item.list, function(listIndex, listItem){   }}
                      {{# if(listItem.name !== undefined) {   }}
                        <a href="{{listItem.url }}" target="_blank" lay-tips="{{listItem.explain }}">{{listItem.name }}</a>
                      {{#  }  }}
                  {{#});}}
                  <button class="layui-btn layui-btn-primary layui-btn-xs" data-type="{{ item.id }}"  lay-tips="向[{{item.explain }}]添加一个快捷方式" onclick="homeConsolePersonShortcutList('{{item.id}}','{{item.name}}')" >
                    <i class="layui-icon layui-icon-add-1"  style="position: relative; top: -1px;" ></i>添加
                  </button>
                  <button class="layui-btn layui-btn-primary layui-btn-xs" data-type="{{ item.id }}"  lay-tips="管理[{{item.explain }}]中的快捷方式" onclick="homeConsolePersonShortcutListUpdate('{{item.id}}','{{item.name}}')" >
                    <i class="layui-icon "  style="position: relative; top: -1px;" >&#xe642;</i>管理
                  </button>

                </div>
              </div>
            </div>
          </div>
      {{#  }); }}

    </script>

  </div>
</div>


<script>
//加载 controller 目录下的对应模块
/*

  小贴士：
    这里 console 模块对应 的 console.js 并不会重复加载，
    然而该页面的视图则是重新插入到容器，那如何保证能重新来控制视图？有两种方式：
      1): 借助 layui.factory 方法获取 console 模块的工厂（回调函数）给 layui.use
      2): 直接在 layui.use 方法的回调中书写业务代码，即:
          layui.use('console', function(){ 
            //同 console.js 中的 layui.define 回调中的代码 
          });
          
  这里我们采用的是方式1。其它很多视图中采用的其实都是方式2，因为更简单些，也减少了一个请求数。
  
*/
layui.use('console', layui.factory('console'));
/*
  下面通过 layui.use 分段加载不同的模块，实现不同区域的同时渲染，从而保证视图的快速呈现
*/




function homeConsolePersonShortcutListUpdate(id,name){

  layui.use(['admin', 'carousel'], function() {
    var $ = layui.$,admin = layui.admin,laytpl = layui.laytpl,form=layui.form,table  = layui.table;

    var data ={
      'typeId':id,
      'typeName':name,
    };

    laytpl($('#home-console-person-shortcut-info').html()).render(data, function(html){
      layer.open({
        type: 1,
        skin: 'layui-layer-rim',
        area: ['85%', '75%'],
        content: html,
        cancel: function(index, layero){
          admin.events.refresh()
        }
      });
      form.render();//渲染动态表单
    });
    //获取列表
    //列表可直接编辑
    table.render({
      elem: '#home-console-person-shortcut-info-table-resetPage'
      ,url: '/home/console/person/shortcut/'+id+'.json'
      ,type:'get'
      ,size: 'lg' //小尺寸的表格
      ,response: {
        statusCode: 200 //规定成功的状态码，默认：0
      }
      ,parseData: function(res){ //res 即为原始返回的数据
        return {
          "code": res.code, //解析接口状态
          "msg": res.msg, //解析提示文本
          "count": res.data.total, //解析数据长度
          "data": res.data.list //解析数据列表
        };
      }
      ,cols: [[
        ,{field:'name', title: '名称', edit: 'text'}
        ,{field:'url',  title: '地址', edit: 'text'}
        ,{field:'explain',  title: '说明', edit: 'text'}
        ,{field:'sort',  title: '排序', edit: 'text'}
        ,{field:'creation_time',  title: '创建时间'}
        ,{field:'update_time',  title: '上次更新时间'}
        ,{  title: '操作' , align:'center', toolbar: '#home-console-person-shortcut-list-toolbar'}

      ]]
    });
    table.reload('home-console-person-shortcut-info-table-resetPage',{
      url: '/home/console/person/shortcut/'+id+'.json'
    });

    //监听单元格编辑
    table.on('edit(home-console-person-shortcut-info-table-table)', function(obj){
          var value = obj.value //得到修改后的值
                  ,data = obj.data //得到所在行所有键值
                  ,field = obj.field; //得到字段
      updateInfo(data)
    });
    //更新
    function  updateInfo(data)
    {

      admin.req({
        url: '/home/console/person/shortcut/'+data.id+'.json' //实际使用请改成服务端真实接口
        ,type:'put'
        ,data: data
        ,done: function(res){
          //登入成功的提示与跳转
          layer.msg(res.msg, {
            offset: '15px'
            ,icon: 1
            ,time: 1000
          }, function(){
            // return false;
          });
        }
      });


    }

    //监听状态操作
    form.on('switch(info-status)', function(obj){
      // var data = obj.data; //获得当前行数据
      var data = JSON.parse(this.value);
      if (obj.elem.checked  === true){
        data.status = 2;
      }else{
        data.status = 1;
      }
      updateInfo(data);
      console.log(obj.elem.checked);
      console.log(obj.othis);
    });
    table.on('tool(home-console-person-shortcut-info-table-table)', function(obj){
      var data = obj.data; //获得当前行数据
      var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
      var tr = obj.tr; //获得当前行 tr 的DOM对象
      if(layEvent === 'del'){ //删除
        layer.confirm('真的删除行么', function(index){
          del(data);
          obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
          layer.close(index);
        });
      } else if(layEvent === 'edit'){ //编辑
        // edit(data);
      } else {

      }
    });
    function del(data) {
      admin.req({
        url: '/home/console/person/shortcut/'+data.id+'.json' //实际使用请改成服务端真实接口
        ,type:'delete'
        ,done: function(res){
          //登入成功的提示与跳转
          layer.msg(res.msg, {
            offset: '15px'
            ,icon: 1
            ,time: 1000
          }, function(){
            // admin.events.refresh();
            // return false;
          });
        }
      });
    }


  })


};
function homeConsolePersonShortcutList(id,name)
{


  layui.use(['admin', 'carousel'], function(){
    var data = {
      "typeId":id,
      "typeName":name,
      "name":'',
      "url":'http://',
      "explain":'',
      "status":2,
    };
    console.log(data);

    var $ = layui.$,admin = layui.admin,laytpl = layui.laytpl,form=layui.form
    laytpl($('#home-console-person-shortcut-list').html()).render(data, function(html){
      layer.open({
        type: 1,
        skin: 'layui-layer-rim',
        // area: ['620px', '740px'],
        content: html
      });
      form.render();//渲染动态表单
    });
    //点击添加
    form.on('submit(home-console-person-shortcut-list-add)', function(data){
      console.log(data.field);
      admin.req({
        url: '/home/console/person/shortcut/'+data.field.typeId+'.json' //实际使用请改成服务端真实接口
        ,type:'post'
        ,data: data.field
        ,done: function(res){
          //登入成功的提示与跳转
          layer.msg(res.msg, {
            offset: '15px'
            ,icon: 1
            ,time: 1000
          }, function(){
            admin.events.refresh();
            return false;
          });
        }
      });
      return false;
    });
  });
}
</script>


<script id="home-console-person-shortcut-info" type="text/html">

  <div class="layui-card">
    <div class="layui-card-header">编辑</div>
    <table class="layui-hide" id="home-console-person-shortcut-info-table-resetPage"  lay-filter="home-console-person-shortcut-info-table-table"></table>

  </div>

</script>


<script id="home-console-person-shortcut-list" type="text/html">

  <div class="layui-card">
    <div class="layui-card-header">快捷方式[{{d.typeName}}]</div>
    <div class="layui-card-body">
      <form class="layui-form"  lay-filter="home-console-person-shortcut-list-form" >
        <div class="layui-row layui-col-space10 layui-form-item">
          <div class="layui-col-lg8">
            <label class="layui-form-label">名称：</label>
            <div class="layui-input-block">
              <input type="text" name="name" lay-verify="required" placeholder="" autocomplete="off" class="layui-input" value={{d.name}}>
            </div>
            {{# if(d.id !==''){ }}
            <input type="hidden" name="typeId" lay-verify="required" placeholder="" autocomplete="off" class="layui-input" value={{d.typeId}}>
            {{# } }}
          </div>
        </div>

        <div class="layui-form-item">
          <label class="layui-form-label">URL：</label>
          <div class="layui-input-block">
            <input type="text" name="url" lay-verify="required" placeholder="" autocomplete="off" class="layui-input" value={{d.url}}>
          </div>
        </div>

        <div class="layui-form-item">
          <label class="layui-form-label">状态：</label>
          <div class="layui-input-block">
            <input type="radio" name="status" value="1" title="隐藏" {{# if(d.status == '1'){ }}checked{{# } }}>
            <input type="radio" name="status" value="2" title="显示" {{# if(d.status == '2'){ }}checked{{# } }}>
          </div>
        </div>
        <div class="layui-form-item">
          <label class="layui-form-label">备注信息：</label>
          <div class="layui-input-block">
            <textarea name="explain" placeholder="" lay-verify="required"  class="layui-textarea">{{d.explain}}</textarea>
          </div>
        </div>
        <div class="layui-form-item">
          <div class="layui-input-block">
            <button class="layui-btn" lay-submit  lay-filter="home-console-person-shortcut-list-add">确认添加</button>
          </div>
        </div>
      </form>
    </div>
  </div>

</script>

<script type="text/html" id="home-console-person-shortcut-list-toolbar">
  {{# var data = JSON.stringify(d); }}
  <input type="checkbox" name="status" value='{{data}}' lay-skin="switch" lay-text="显示|隐藏" lay-filter="info-status" {{ d.status == 2 ? 'checked' : '' }}>
  <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>

